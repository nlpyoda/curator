"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[508],{6508:(e,r,t)=>{t.r(r),t.d(r,{SupabaseService:()=>a});var i=t(9355);class a{constructor(){this.supabase=null,this.initialized=!1}async initialize(){try{const r={NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"CuratorApp52",slug:"curatorapp52",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",userInterfaceStyle:"light",splash:{image:"./assets/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},scheme:"curatorapp52",sdkVersion:"51.0.0",platforms:["ios","android","web"],extra:{router:{origin:!1}}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.EXPO_PUBLIC_SUPABASE_KEY||{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"CuratorApp52",slug:"curatorapp52",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",userInterfaceStyle:"light",splash:{image:"./assets/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},scheme:"curatorapp52",sdkVersion:"51.0.0",platforms:["ios","android","web"],extra:{router:{origin:!1}}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.SUPABASE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV1Ympqanh6eXdweXhpcWN4bmZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2NTIwODQsImV4cCI6MjA2NDIyODA4NH0.ba0c3uKsmhs9BosnuqLJFUYyjDYZQGxNDZE-qWA5v-4";if(!r)throw new Error("Supabase key not found in environment variables");this.supabase=(0,i.createClient)("https://uubjjjxzywpyxiqcxnfn.supabase.co",r);try{const{data:e,error:r}=await this.supabase.from("Product").select("*").limit(1);if(r){if(r.message.includes('relation "Product" does not exist'))throw console.log("\ud83d\udccb Product table does not exist in Supabase yet"),new Error("Product table does not exist. Please create the table first.");throw r}}catch(e){throw e}return this.initialized=!0,console.log("\u2705 Supabase service initialized successfully"),!0}catch(r){return console.log("\u274c Supabase initialization failed:",r.message),this.initialized=!1,!1}}async searchProducts(e,r=null,t=10){if(!this.initialized)throw new Error("Supabase service not initialized");try{const i=e.toLowerCase().trim();let a=this.supabase.from("Product").select("*").or(`title.ilike.%${i}%,description.ilike.%${i}%,features.ilike.%${i}%`).limit(t);const{data:s,error:o}=await a;if(o)throw o;const n=s.map((e=>{const t={id:e.id,title:e.title,price:e.price,link:e.link,description:e.description,features:e.features,whyBuy:e.whyBuy,image:e.image||"",reviews:{amazon:e.amazonReviewSummary||"",instagram:e.instagramReviewSummary||"",marketplace:e.fbMarketplaceSummary||""},prosAndCons:e.prosAndCons||{pros:[],cons:[]},lastUpdated:e.lastUpdated?new Date(e.lastUpdated).toISOString().split("T")[0]:"",source:e.source};let i=.5;if(r){const t=r.toLowerCase();t.includes("tech")&&(e.title.toLowerCase().includes("headphones")||e.title.toLowerCase().includes("smart")||e.title.toLowerCase().includes("macbook"))&&(i+=.3),t.includes("professional")&&(e.description.toLowerCase().includes("professional")||e.description.toLowerCase().includes("work"))&&(i+=.2),t.includes("quality")&&e.prosAndCons?.pros?.some((e=>e.toLowerCase().includes("quality")))&&(i+=.2)}return Object.assign({},t,{similarity:Math.min(i,.97)})}));return n.sort(((e,r)=>r.similarity-e.similarity)),console.log(`Found ${n.length} products from Supabase`),n}catch(i){throw console.error("Supabase search error:",i),i}}async getAllProducts(e=50){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:r,error:t}=await this.supabase.from("Product").select("*").limit(e);if(t)throw t;return r.map((e=>({id:e.id,title:e.title,price:e.price,link:e.link,description:e.description,features:e.features,whyBuy:e.whyBuy,image:e.image||"",reviews:{amazon:e.amazonReviewSummary||"",instagram:e.instagramReviewSummary||"",marketplace:e.fbMarketplaceSummary||""},prosAndCons:e.prosAndCons||{pros:[],cons:[]},lastUpdated:e.lastUpdated?new Date(e.lastUpdated).toISOString().split("T")[0]:"",source:e.source})))}catch(r){throw console.error("Error fetching all products:",r),r}}async addProduct(e){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:r,error:t}=await this.supabase.from("Product").insert([{title:e.title,price:e.price,link:e.link,source:e.source,description:e.description,features:e.features,whyBuy:e.whyBuy,amazonReviewSummary:e.reviews?.amazon||"",instagramReviewSummary:e.reviews?.instagram||"",fbMarketplaceSummary:e.reviews?.marketplace||"",prosAndCons:e.prosAndCons,category:e.category,subCategory:e.subCategory,tags:e.tags||[],attributes:e.attributes||{}}]).select();if(t)throw t;return console.log("Product added to Supabase:",r[0]?.title),r[0]}catch(r){throw console.error("Error adding product to Supabase:",r),r}}async getProductCount(){if(!this.initialized)return 0;try{const{count:e,error:r}=await this.supabase.from("Product").select("*",{count:"exact",head:!0});if(r)throw r;return e||0}catch(e){return console.error("Error getting product count:",e),0}}async updateProduct(e,r){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:t,error:i}=await this.supabase.from("Product").update(r).eq("id",e).select();if(i)throw i;return t[0]}catch(t){throw console.error("Error updating product in Supabase:",t),t}}async searchProductsByImageSimilarity(e,r=.7,t=10){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:i,error:a}=await this.supabase.rpc("search_products_by_image_similarity",{query_embedding:e,match_threshold:r,match_count:t});if(a)throw a;return i.map((e=>Object.assign({},e,{similarity:e.similarity||0})))}catch(i){throw console.error("Error in image similarity search:",i),i}}async searchProductsMultimodal(e="",r=null,t={}){if(!this.initialized)throw new Error("Supabase service not initialized");const{textWeight:i=.6,imageWeight:a=.4,limit:s=10}=t;try{const{data:t,error:o}=await this.supabase.rpc("search_products_multimodal",{text_query:e,image_embedding:r,text_weight:i,image_weight:a,match_count:s});if(o)throw o;return t.map((e=>({id:e.id,title:e.title,price:e.price,link:e.link,image:e.image||"",description:e.description,similarity:e.combined_score||0,source:"Supabase"})))}catch(o){if(console.error("Error in multimodal search:",o),e)return await this.searchProducts(e,null,s);throw o}}async updateProductEmbedding(e,r,t={}){if(!this.initialized)throw new Error("Supabase service not initialized");try{const i={image_embedding:r,embedding_model:t.model||"clip-vit-base-patch32",embedding_created_at:(new Date).toISOString()},{data:a,error:s}=await this.supabase.from("Product").update(i).eq("id",e).select();if(s)throw s;return a[0]}catch(i){throw console.error("Error updating product embedding:",i),i}}async getProductsWithoutEmbeddings(e=50){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:r,error:t}=await this.supabase.from("Product").select("id, title, description, image").is("image_embedding",null).not("image","is",null).limit(e);if(t)throw t;return r}catch(r){throw console.error("Error fetching products without embeddings:",r),r}}async getBrandPersonas(){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:e,error:r}=await this.supabase.from("brand_personas").select("*").order("brand_name");if(r)throw r;const t={};return e.forEach((e=>{t[e.brand_name]={persona:e.persona,description:e.description,keywords:e.keywords,values:e.values,demographics:e.demographics}})),t}catch(e){throw console.error("Error fetching brand personas:",e),e}}async addBrandPersona(e){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:r,error:t}=await this.supabase.from("brand_personas").upsert({brand_name:e.brandName,persona:e.persona,description:e.description,keywords:e.keywords,values:e.values,demographics:e.demographics},{onConflict:"brand_name"}).select();if(t)throw t;return console.log("Brand persona added to Supabase:",r[0]?.brand_name),r[0]}catch(r){throw console.error("Error adding brand persona to Supabase:",r),r}}async deleteProduct(e){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:r,error:t}=await this.supabase.from("Product").delete().eq("id",e).select();if(t)throw t;return r[0]}catch(r){throw console.error("Error deleting product from Supabase:",r),r}}async deleteAllProducts(){if(!this.initialized)throw new Error("Supabase service not initialized");try{const{data:e,error:r}=await this.supabase.from("Product").delete().neq("id","00000000-0000-0000-0000-000000000000");if(r)throw r;return e}catch(e){throw console.error("Error deleting all products from Supabase:",e),e}}async cleanup(){this.initialized=!1}}}}]);
//# sourceMappingURL=508.f47c8ece.chunk.js.map